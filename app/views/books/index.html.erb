<p id="notice"><%= notice %></p>

<div class="text-center">
  <h1>Browse Books</h1>
  <p>To checkout or check-in books, please <%= link_to "login", login_path %>.</p>
</div>
<hr />

<div class="row">
  <%= form_tag books_path, :method => 'get', class: 'input-group'  do %>
    <%= text_field_tag :search, params[:search], class: 'form-control', placeholder: 'Search by title, author, or ISBN...' %>
    <span class="input-group-btn">
      <%= submit_tag "search", class: "btn btn-primary" %>
    </span>
  <% end %>
</div>
<hr />

<table class="table table-striped">
  <thead>
    <tr>
      <th>Isbn</th>
      <th>Title</th>
      <th>Author</th>
      <th>Genre</th>
      <th>Shelving Code</th>
      <th>Publisher</th>
      <th>Language</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @books.each do |book| %>
      <tr>
        <td><%= book.isbn %></td>
        <td><%= book.title %></td>
        <td><%= book.author %></td>
        <td><%= book.genre %></td>
        <td><%= book.shelving_code %></td>
        <td><%= book.publisher %></td>
        <td><%= book.language %></td>
        <td><%= link_to 'View', book_path(book.isbn), :class => 'btn btn-mini' %></td>

        <% @student = Student.find_by_id(session[:current_student_id]) %>
        <% if book.available == true && %>
        <td>  <%= link_to 'Checkout', book, method: :post, data: { confirm: 'Are you sure you would like to checkout this book?' }, :class => 'btn btn-mini' %></td>
            <%end%>
        <% if book.available == false %>
            <% @checkout_history = CheckoutHistory.find_by(isbn: book.isbn) %>
            <% if !signed_in? %>
            <td> Not Available </td>
             
                    <% elsif (@checkout_history.email == @student.email || @student.student_type=='P' || @student.student_type=='A') %>

            <td>  <%= link_to 'Check-in', book, method: :post, data: { confirm: 'Are you sure you would like to check-in this book?'}, :class => 'btn btn-mini' %></td>
               
            <%end%>
            <%end%>


    <% end %>
  </tbody>
</table>

<div class='text-center'>
<%= link_to 'View By Categories', new_book_path, {:style=>'color:#FFFFFF; font-size:200%;', :class => "btn btn-primary"} %>
</div>
